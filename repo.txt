#require 'wrap'
require "rspec"
require "watir-webdriver"
require 'byebug'

describe "test" do
  #let(:@browser) { @@browser ||= Watir::Browser.new :firefox }
  before(:all) do
    @browser ||= Watir::Browser.new :firefox
    @browser.goto "https://www.x1.wrapdev.net/index/"
    @browser.window.maximize()
  end

  after(:all) { @browser.close }

  it "should create a new personal account" do
    @browser.span(:text,"PLANS & PRICING").when_present.click
    @browser.execute_script('arguments[0].scrollIntoView();', @browser.a(:text,/Try Small Business for Free/i))
    @browser.a(:text,/Sign Up/i).when_present.click
    user_name = "rmadhu.nair#{rand(2000...2000000)}"
    @browser.text_field(:placeholder ,"Email").when_present.set "#{user_name}@gmail.com"
    @browser.button(:text,"Sign Up").click
    expect(@browser.div(:class, "signup_suggested-username").when_present.text.include? user_name).to be_truthy
    @browser.text_field(:placeholder ,"Create a username").when_present.set user_name
    @browser.text_field(:placeholder ,"Password").when_present.set "test123"
    sleep(3)
    @browser.button(:text, /Create Account/i).when_present.click
    @browser.text_field(:placeholder, "First Name *").when_present.set "Madhu"
    @browser.text_field(:placeholder, "Last Name *").when_present.set "Ram"
    @browser.text_field(:placeholder, "Company *").when_present.set "Wrap INC"
    @browser.text_field(:placeholder, "Phone Number").when_present.set "6144327035"
    @browser.button(:text, "Create account").when_present.click
    expect(@browser.div(:class,"global-nav_user-name").when_present.text == user_name).to be_truthy
  end

  it "should create a new template" do
    @browser.button(:text,"Create new wrap").when_present.click
    sleep 2
    @browser.button(:text,"Start from scratch").when_present.click
    @browser.div(:text,"Wrap properties").when_present.click
    @wrap_name = "test_Wrap#{rand(2000...2000000)}"
    @browser.text_field(:id,"wrap-name").when_present.set @wrap_name
    @browser.button(:text,"Save").when_present.click
    sleep 5
    expect(@browser.div(:class, "action-bar_wrap-name ng-binding").when_present.text == @wrap_name).to be_truthy
  end

  it "should publish a template" do
    @browser.button(:text,"Publish").when_present.click
    sleep 5
    expect(@browser.div(:class,"publish-notification").h4(:class,"modal-title").text == "Publish Successful").to be_truthy
    expect(@browser.span(:class,"publish-notification_primary").text == "#{@wrap_name} is live" ).to be_truthy
    @browser.button(:text,"Close").click
  end

end

#require 'wrap'
require "rspec"
require "watir-webdriver"
require 'byebug'

describe "test" do
  #let(:@browser) { @@browser ||= Watir::Browser.new :firefox }
  before(:all) do
    @browser ||= Watir::Browser.new :firefox
    @browser.goto "https://www.x1.wrapdev.net/index/"
    @browser.window.maximize()
  end

  after(:all) { @browser.close }

  it "should create a new personal account" do
    @browser.span(:text,"PLANS & PRICING").when_present.click
    @browser.execute_script('arguments[0].scrollIntoView();', @browser.a(:text,/Try Small Business for Free/i))
    @browser.a(:text,/Sign Up/i).when_present.click
    user_name = "rmadhu.nair#{rand(2000...2000000)}"
    @browser.text_field(:placeholder ,"Email").when_present.set "#{user_name}@gmail.com"
    @browser.button(:text,"Sign Up").click
    expect(@browser.div(:class, "signup_suggested-username").when_present.text.include? user_name).to be_truthy
    @browser.text_field(:placeholder ,"Create a username").when_present.set user_name
    @browser.text_field(:placeholder ,"Password").when_present.set "test123"
    sleep(3)
    @browser.button(:text, /Create Account/i).when_present.click
    @browser.text_field(:placeholder, "First Name *").when_present.set "Madhu"
    @browser.text_field(:placeholder, "Last Name *").when_present.set "Ram"
    @browser.text_field(:placeholder, "Company *").when_present.set "Wrap INC"
    @browser.text_field(:placeholder, "Phone Number").when_present.set "6144327035"
    @browser.button(:text, "Create account").when_present.click
    expect(@browser.div(:class,"global-nav_user-name").when_present.text == user_name).to be_truthy
  end

  it "should create a new template" do
    @browser.button(:text,"Create new wrap").when_present.click
    sleep 2
    @browser.button(:text,"Start from scratch").when_present.click
    sleep 5
    @browser.button(:class,"help-tour_nav").when_present.click
    sleep 5
    @browser.div(:text,"Wrap properties").when_present.click
    @wrap_name = "test_Wrap#{rand(2000...2000000)}"
    @browser.text_field(:id,"wrap-name").when_present.set @wrap_name
    require 'byebug';byebug
    @browser.button(:text,"Save").when_present.click
    @browser.div(:class,/rect-container_rect/).wait_while_present
    expect(@browser.div(:class, "action-bar_wrap-name ng-binding").when_present.text == @wrap_name).to be_truthy
  end

  it "should publish a template" do
    require 'byebug';byebug
    @browser.button(:text,"Publish").when_present.click if @browser.button(:text,"Publish").enabled?
    sleep 5
    expect(@browser.div(:class,"publish-notification").h4(:class,"modal-title").text == "Publish Successful").to be_truthy
    expect(@browser.span(:class,"publish-notification_primary").text == "#{@wrap_name} is live" ).to be_truthy
    @browser.button(:text,"Close").click
  end

end


